(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{365:function(e,t,s){"use strict";s.r(t);var n=s(12),a=Object(n.a)({},(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("social-share"),e._v(" "),s("h1",{attrs:{id:"nodemcu-deep-sleep-mode"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nodemcu-deep-sleep-mode"}},[e._v("#")]),e._v(" NodeMCU deep sleep mode")]),e._v(" "),s("p",[e._v("Using a battery is always a cool way to supply our board, however, batteries have a limited duration. If our board doesn't need to be running permanently, why we should keep it wasting battery? Here is where deep sleep mode helps us.")]),e._v(" "),s("h3",{attrs:{id:"how-it-works"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#how-it-works"}},[e._v("#")]),e._v(" How it works")]),e._v(" "),s("p",[e._v("Once the device enters deep sleep mode, it turns off almost every inner component. This mode can be configured using a timer so it wakes itself up after a predefined period of time or using an external wake up so it wakes up when you press the "),s("code",[e._v("RST")]),e._v(" (reset) button.")]),e._v(" "),s("h3",{attrs:{id:"example"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#example"}},[e._v("#")]),e._v(" Example")]),e._v(" "),s("p",[e._v("For our example, we are going to use the timer mode. This means the device will sleep for a predefined amount of time and then it'll wake itself up.")]),e._v(" "),s("img",{staticClass:"image-center",attrs:{src:"/nodemcu-deep-sleep/diagram.png",height:"250",width:"auto"}}),e._v(" "),s("p",[e._v("The "),s("code",[e._v("GPIO16")]),e._v(" ("),s("code",[e._v("D0")]),e._v(") pin connected to "),s("code",[e._v("RST")]),e._v(" pin, will simulate the "),s("em",[e._v('"press the RST button"')]),e._v(" action so we don't need to press the button each time the device should wake up.")]),e._v(" "),s("p",[e._v("Recommended reading: "),s("a",{attrs:{href:"https://components101.com/development-boards/nodemcu-esp8266-pinout-features-and-datasheet",target:"_blank",rel:"noopener noreferrer"}},[e._v("NodeMCU Pinout Reference"),s("OutboundLink")],1)]),e._v(" "),s("h4",{attrs:{id:"sketch-for-testing-deep-sleep-mode"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#sketch-for-testing-deep-sleep-mode"}},[e._v("#")]),e._v(" Sketch for testing deep sleep mode")]),e._v(" "),s("div",{staticClass:"language-c extra-class"},[s("pre",{pre:!0,attrs:{class:"language-c"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// Baud rate")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token macro property"}},[e._v("#"),s("span",{pre:!0,attrs:{class:"token directive keyword"}},[e._v("define")]),e._v(" BAUD_RATE 9600")]),e._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("void")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("setup")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  Serial"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("begin")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("BAUD_RATE"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  \n  Serial"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"Hello from setup()"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  Serial"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"Going to sleep 10s"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("//doSomething();")]),e._v("\n  \n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// 10 * 1000000us = 10s")]),e._v("\n  ESP"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("deepSleep")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("10")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[e._v("1000000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("void")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("loop")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),s("p",[e._v("When using deep sleep mode, our "),s("code",[e._v("loop")]),e._v(" block doesn't make sense because the device will shutdown itself once it reach the line "),s("code",[e._v("ESP.deepSleep(...)")]),e._v(". That's why you should do any action (or call it) inside the "),s("code",[e._v("setup")]),e._v(" block and before the "),s("code",[e._v("ESP.deepSleep(...)")]),e._v(".")]),e._v(" "),s("p",[e._v("The "),s("code",[e._v("setup")]),e._v(" block should look like this:")]),e._v(" "),s("div",{staticClass:"language-c extra-class"},[s("pre",{pre:!0,attrs:{class:"language-c"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("void")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("setup")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// Init things. ")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// e.g: connect to Wi-Fi")]),e._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// Do something. ")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// e.g: read sensor and send data")]),e._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// Sleep")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),s("p",[e._v("The function "),s("code",[e._v("ESP.deepSleep")]),e._v(" uses "),s("code",[e._v("Î¼s")]),e._v(" as unit, so you have to multiply the amount of seconds by 1000000. E.g: if you want to sleep for 20 seconds, you'll need "),s("code",[e._v("ESP.deepSleep(20 * 1000000);")])]),e._v(" "),s("p",[e._v("A typical use case is about reading current temperature and humidity, send the data to somewhere else and go to sleep every hour.")]),e._v(" "),s("p",[e._v("Recommended sketch: "),s("a",{attrs:{href:"https://github.com/jesusgn90/nodemcu-examples/blob/master/MQTT-WIFI-DHT11/mqtt-wifi-dht11-deep-sleep.ino",target:"_blank",rel:"noopener noreferrer"}},[e._v("MQTT + Wi-Fi + DHT11 + Deep Sleep"),s("OutboundLink")],1)]),e._v(" "),s("h3",{attrs:{id:"about-powerbanks"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#about-powerbanks"}},[e._v("#")]),e._v(" About powerbanks")]),e._v(" "),s("p",[e._v("There is a known problem with this kind of battery, most of them come with a preventive measure so it auto-turns itself off when there is no connected device. Once our NodeMCU is in deep sleep mode, it uses to consume about "),s("code",[e._v("0.04mA")]),e._v(" (from my readings), so the power bank thinks there is no connected device. To solve this you have several options:")]),e._v(" "),s("ul",[s("li",[e._v("Modify the power bank to bypass this limitation.")]),e._v(" "),s("li",[e._v("Extract the batteries from the power bank and use them as it.")]),e._v(" "),s("li",[e._v("Use a power bank designed for IoT devices, they can be configured to avoid this behavior.")]),e._v(" "),s("li",[e._v("Use a different kind of battery ðŸ˜„.")])]),e._v(" "),s("Disqus")],1)}),[],!1,null,null,null);t.default=a.exports}}]);